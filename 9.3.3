-- 1. Create the STUDENT_DETAILS table
CREATE TABLE STUDENT_DETAILS (
  student_id NUMBER PRIMARY KEY,
  student_name VARCHAR2(100),
  subject_name VARCHAR2(100),
  marks NUMBER
);

-- 2. Create a user-defined exception for invalid marks
DECLARE
  ex_invalid_marks EXCEPTION;
  PRAGMA EXCEPTION_INIT(ex_invalid_marks, -20001);
BEGIN
  NULL;
END;
/

-- 3. Create the procedure to insert student data with marks validation and exception handling
CREATE OR REPLACE PROCEDURE insert_student_details(
  p_student_id    IN NUMBER,
  p_student_name  IN VARCHAR2,
  p_subject_name  IN VARCHAR2,
  p_marks         IN NUMBER)
IS
  ex_invalid_marks EXCEPTION;
  PRAGMA EXCEPTION_INIT(ex_invalid_marks, -20001);
BEGIN
  -- Validate marks between 0 and 100
  IF p_marks < 0 OR p_marks > 100 THEN
    RAISE ex_invalid_marks;
  END IF;

  -- Insert the valid record into the table
  INSERT INTO STUDENT_DETAILS(student_id, student_name, subject_name, marks)
  VALUES (p_student_id, p_student_name, p_subject_name, p_marks);

  DBMS_OUTPUT.PUT_LINE('Record inserted successfully for student: ' || p_student_name);

EXCEPTION
  WHEN ex_invalid_marks THEN
    DBMS_OUTPUT.PUT_LINE('Error: Invalid marks ' || p_marks || ' for student ' || p_student_name || '. Must be between 0 and 100.');
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE('An unexpected error occurred: ' || SQLERRM);
END insert_student_details;
/

-- 4. Test the procedure with sample data (both valid and invalid marks)

BEGIN
  insert_student_details(1, 'Ravi', 'Math', 85);    -- Valid
  insert_student_details(2, 'Priya', 'Science', 72); -- Valid
  insert_student_details(3, 'Kiran', 'English', -5); -- Invalid
  insert_student_details(4, 'Sneha', 'Math', 95);    -- Valid
  insert_student_details(5, 'Arjun', 'Science', 105);-- Invalid
  insert_student_details(6, 'Meena', 'English', 41); -- Valid
  insert_student_details(7, 'Rahul', 'Math', 60);    -- Valid
  insert_student_details(8, 'Divya', 'Science', 33); -- Valid
  insert_student_details(9, 'Vikram', 'English', 55);-- Valid
  insert_student_details(10, 'Riya', 'Math', 18);    -- Valid
END;
/

-- 5. Verify valid records were inserted
SELECT * FROM STUDENT_DETAILS ORDER BY student_id;
